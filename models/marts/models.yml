version: 2

models:
  - name: dim_date
    description: "Date dimension generated by dbt_utils.date_spine"
    config:
      tags: ["dimension"]
      schema: dwh    
      contract:
        enforced: true
    columns:
      - name: date_key
        data_type: string
        constraints:
          - type: primary_key
      - name: full_date
        data_type: datetime
      - name: year
        data_type: int
      - name: month
        data_type: int
      - name: day
        data_type: int
      - name: week_of_year
        data_type: int
      - name: day_of_year
        data_type: int
      - name: quarter_of_year
        data_type: int
      - name: day_of_week
        data_type: int
      - name: month_name
        data_type: string
      - name: day_name
        data_type: string
      - name: is_last_day_of_month
        data_type: boolean
      - name: is_weekend
        data_type: boolean

  - name: dim_order_status
    config:
      tags: ["dimension"]
      schema: dwh    
      contract:
        enforced: true
    columns:
      - name: order_status_key
        data_type: string
        constraints:
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: order_status
        data_type: int
      - name: order_status_name
        data_type: string

  - name: dim_address
    description: "Address dimension"
    config:
      tags: ["dimension"]
      schema: dwh    
      contract:
        enforced: true
    columns:
      - name: address_key
        data_type: string
        constraints:
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: address_id
        data_type: int
      - name: city
        data_type: string
      - name: state
        data_type: string
      - name: country
        data_type: string

  - name: dim_credit_card
    description: "Credit card dimension"
    config:
      tags: ["dimension"]
      schema: dwh
      contract:
        enforced: true
    columns:
      - name: credit_card_key
        data_type: string
        constraints:
          - type: primary_key
        tests: 
          - unique
          - not_null
      - name: credit_card_id
        data_type: int
      - name: card_type
        data_type: string

  - name: dim_customer
    description: "Customer dimension with denormalized person info"
    config:
      tags: ["dimension"]
      schema: dwh    
      contract:
        enforced: true
    columns:
      - name: customer_key
        data_type: string
        constraints:
          - type: primary_key
        tests: 
          - unique
          - not_null
      - name: customer_id
        data_type: int
      - name: person_business_entity_id
        data_type: int
      - name: full_name
        data_type: string
      - name: total_purchase_ytd
        data_type: float
      - name: date_first_purchase
        data_type: date
      - name: birth_date
        data_type: date
      - name: marital_status
        data_type: string
      - name: yearly_income
        data_type: string
      - name: gender
        data_type: string
      - name: total_children
        data_type: int
      - name: number_children_at_home
        data_type: int
      - name: education
        data_type: string
      - name: occupation
        data_type: string
      - name: home_owner_flag
        data_type: int
      - name: number_cars_owned
        data_type: int
      - name: commute_distance
        data_type: string

  - name: dim_product
    description: "Product dimension"
    config:
      tags: ["dimension"]
      schema: dwh
      contract:
        enforced: true
    columns:
      - name: product_key
        data_type: string
        constraints:
          - type: primary_key
        tests: 
          - unique
          - not_null
      - name: product_id
        data_type: int
      - name: product_name
        data_type: string
      - name: product_number
        data_type: string
      - name: color
        data_type: string
      - name: class
        data_type: string
      - name: product_subcategory_name
        data_type: string
      - name: product_category_name
        data_type: string

  - name: fact_sales
    description: "Sales fact table"
    config:
      tags: ["fact"]
      schema: dwh    
      contract:
        enforced: true
    columns:
      - name: sales_key
        constraints:
          - type: primary_key
        data_type: string
        tests:
          - unique
          - not_null
      - name: product_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_product")
            to_columns: [product_key]
      - name: customer_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_customer")
            to_columns: [customer_key]
      - name: credit_card_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_credit_card")
            to_columns: [credit_card_key]
      - name: ship_address_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_address")
            to_columns: [address_key]
      - name: order_status_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_order_status")
            to_columns: [order_status_key]
      - name: order_date_key
        data_type: string
        constraints:
          - type: foreign_key
            to: ref("dim_date")
            to_columns: [date_key]
      - name: order_date
        data_type: date
      - name: unit_price
        data_type: float
      - name: unit_price_discount
        data_type: float
      - name: cost_of_goods_sold
        data_type: float
      - name: order_quantity
        data_type: int
      - name: gross_revenue
        data_type: float
      - name: gross_profit
        data_type: float

  - name: obt_sales
    description: "One Big Table table joining fact_sales to dimensions"
    config:
      tags: ["obt"]
      schema: dwh    
    columns:
      - name: order_date
        description: "Order date (partition field)"
